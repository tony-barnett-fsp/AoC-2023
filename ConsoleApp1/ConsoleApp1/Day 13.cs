using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http.Headers;
using System.Text;
using System.Threading.Tasks;

namespace ConsoleApp1
{
    internal class Day13
    {
        private string _input = "##...##....##\r\n..#.##....#.#\r\n..#.##....#.#\r\n##.#.##....##\r\n#####.#..###.\r\n#....#.####.#\r\n..###.##.....\r\n..###.##.....\r\n#....#.####.#\r\n\r\n....##.......\r\n####..#######\r\n###.##.######\r\n.#.#..#.#..#.\r\n#..#..#..##..\r\n.#.#..#.#..#.\r\n####..#######\r\n..#....#.....\r\n#.#....#.##.#\r\n###.##.######\r\n.########..##\r\n####..#######\r\n##.####.####.\r\n\r\n#.#..##....\r\n#.#...#....\r\n.#.##....#.\r\n.####..##..\r\n#####.....#\r\n.#..####.##\r\n########.#.\r\n###..##..##\r\n#.#..####.#\r\n#..#.##.###\r\n..#...#####\r\n#....#...##\r\n#....#...##\r\n..#...#####\r\n#..#.##.###\r\n\r\n#########.##.##\r\n##.....#.####.#\r\n#.#.##...####..\r\n...#####..##...\r\n#.....#...##...\r\n.##..#..#.##.#.\r\n.##..#...#..#..\r\n####..##.#..#.#\r\n####..##.#..#.#\r\n\r\n.#..###..##.#\r\n.#..###..##.#\r\n##..#.###.###\r\n#.##...#..##.\r\n..####...#..#\r\n##..#..#.#...\r\n###..#.....##\r\n....##.##..#.\r\n....##.#...#.\r\n\r\n..#....##.#.##.\r\n...###...###..#\r\n#...##..####..#\r\n#...##..####..#\r\n...###...#.#..#\r\n..#....##.#.##.\r\n.#.......###..#\r\n##.........#..#\r\n..##.###...#..#\r\n.##...#........\r\n####..##.#.....\r\n....#.#.###....\r\n....#.###..####\r\n.##....##.##..#\r\n#..##.#..###..#\r\n.#...#######..#\r\n#.####.#####..#\r\n\r\n##.##########\r\n..#....##....\r\n..#####..####\r\n###..#....#..\r\n..#..######..\r\n....##.##.##.\r\n...##.####.##\r\n###.#.#..#.#.\r\n..##...###..#\r\n##....####...\r\n..#.##....##.\r\n\r\n.##.###...#\r\n#.###....##\r\n....####.##\r\n.#.##...#.#\r\n.#.##...#.#\r\n....####.##\r\n#.###....##\r\n.##.###...#\r\n#..##.##...\r\n#.###.#..#.\r\n#.#.....#..\r\n#...#.##.#.\r\n##...#..##.\r\n#..#.#.....\r\n##.#.#.....\r\n\r\n..##.##.##.....#.\r\n#.#...#.#..##..##\r\n####...#.####..#.\r\n####...#.####..#.\r\n#.#...#.#..##..##\r\n..##.##.##.....#.\r\n.##.....#.###..#.\r\n#####.......#...#\r\n...###.#.#.###.##\r\n###..##.#..#..##.\r\n###..##....#..##.\r\n...###.#.#.###.##\r\n#####.......#...#\r\n.##.....#.###..#.\r\n..##.##.##.....#.\r\n#.#...#.#..##..##\r\n####...#.####..#.\r\n\r\n#...######.##\r\n.##...##.....\r\n.#....##.....\r\n#...######.##\r\n####.#.#..#..\r\n..#.##.#..#..\r\n.#####..#..##\r\n######..##...\r\n##....#.#####\r\n\r\n##.........\r\n#..##.....#\r\n#.#......##\r\n#.#.#####.#\r\n.####...##.\r\n#.###.##.##\r\n.##....#.##\r\n####..#####\r\n####..#####\r\n.##....#.##\r\n#.###.##.##\r\n.####...##.\r\n#.#.#####.#\r\n#.#......##\r\n#.###.....#\r\n##.........\r\n##.........\r\n\r\n.##..###.##\r\n....#...#.#\r\n....#...#.#\r\n.##..###.##\r\n.#.#....###\r\n#.#..##.#..\r\n..#...###.#\r\n#.##..##.#.\r\n..#..#.#...\r\n###.#..##.#\r\n.##########\r\n.##########\r\n###.#..##.#\r\n..#..#.#.#.\r\n#.##..##.#.\r\n..#...###.#\r\n#.#..##.#..\r\n\r\n###..####.#\r\n.#....#...#\r\n.#.##.#...#\r\n..#..#..##.\r\n...##...#..\r\n.#.##.#...#\r\n#......#...\r\n##....###.#\r\n##.##.###..\r\n..####...##\r\n...##....#.\r\n#......##..\r\n.##..##.##.\r\n.######.###\r\n###..###.#.\r\n###..###.#.\r\n.######.##.\r\n\r\n.#.#..#.#.##.\r\n.##.##.##....\r\n.#.#..#.#....\r\n.#.#..#.#.##.\r\n#.##..##.####\r\n..#....#.....\r\n.#......#....\r\n###.##.###.##\r\n..#....#..##.\r\n\r\n##.#.####.#.#\r\n...###..###..\r\n##...####...#\r\n####......###\r\n..###.##.###.\r\n..#.#..#.#.#.\r\n.....#..#....\r\n##..##..##..#\r\n###.######.##\r\n...#.####.#..\r\n....######...\r\n###.#....#.##\r\n..####..####.\r\n####.#..#.###\r\n##.#.####.#.#\r\n##..#.##.#..#\r\n##..##..##..#\r\n\r\n#..####\r\n#..####\r\n#..#.##\r\n.#..##.\r\n#..####\r\n####...\r\n####...\r\n#..#.##\r\n.#..##.\r\n\r\n.##.#.#.##.\r\n######.#..#\r\n.##....##.#\r\n.##...##..#\r\n#..#.#.#..#\r\n....##.....\r\n#..#.##....\r\n....#.#.##.\r\n#..####....\r\n\r\n.###..##.\r\n##...#.#.\r\n#.#.#...#\r\n#.#.#...#\r\n##...#.#.\r\n.###..##.\r\n####..##.\r\n\r\n#....###.##.###..\r\n.####.##.##.##.##\r\n#....#........#..\r\n##..###......###.\r\n######.##..##.###\r\n.#..#..........#.\r\n......##.##.##...\r\n#.##.#.##...#.#.#\r\n#######......####\r\n#######.####.####\r\n#.##.#........#.#\r\n\r\n#.#....#..#\r\n#.#....#..#\r\n########.##\r\n.#.#.###.#.\r\n.##.##..##.\r\n.#....#..#.\r\n.#....#..#.\r\n.##.##..##.\r\n.#.#.###.#.\r\n########.##\r\n#.#..#.#..#\r\n\r\n###.#..##...#\r\n..#...##..###\r\n...#.....#.#.\r\n#####...##...\r\n#######.....#\r\n..#..##..##.#\r\n..#..##..##.#\r\n#######.....#\r\n#####...##...\r\n...#.#...#.#.\r\n..#...##..###\r\n###.#..##...#\r\n..#.#.###.#..\r\n..###....####\r\n###..########\r\n##....##..#.#\r\n......##.##..\r\n\r\n##..##.\r\n###.##.\r\n######.\r\n##..#..\r\n.....##\r\n..##.##\r\n..#####\r\n...##..\r\n..#....\r\n##.###.\r\n#####.#\r\n##..#..\r\n....#..\r\n##.##.#\r\n##.....\r\n....#.#\r\n#####.#\r\n\r\n#...#....#...\r\n#..########..\r\n.####.##.####\r\n#####....####\r\n#..#......#..\r\n.#####..#####\r\n.##.#.##.#.##\r\n.##.######.##\r\n....##..##...\r\n#.....##.....\r\n.#..#.##.#..#\r\n#.....##.....\r\n.....####....\r\n.###.#..#.###\r\n.##.#....#.##\r\n....######...\r\n###.######.##\r\n\r\n...#....#.....###\r\n####....######...\r\n.#.######.#.#.#..\r\n....####.......##\r\n....####.......##\r\n.#.######.#.#.#..\r\n###......#####...\r\n...#....#.....###\r\n....#..#.....##..\r\n....#..#.....####\r\n#.###..###.##..#.\r\n\r\n##..###\r\n.####..\r\n.#..#..\r\n.####..\r\n.####..\r\n#....##\r\n.####..\r\n.#..#..\r\n..##.##\r\n\r\n.#..###..###..#\r\n.###.#....#.#.#\r\n...##..##..##..\r\n#...#.####.#...\r\n##...######...#\r\n#.####.##.####.\r\n###.##....##.##\r\n###.##....##.##\r\n#.####.##.####.\r\n\r\n#........#.####\r\n###.##.###.##..\r\n###.##.######..\r\n.#......#..##..\r\n###.##.###...##\r\n#.##..##.#..###\r\n####..#####.###\r\n###.##.##....##\r\n#........##.#..\r\n.###..###..####\r\n..######..##.##\r\n###....###.....\r\n#.#.##.#.#.##..\r\n##..##..###.###\r\n#..#..#..##....\r\n.##....##.#....\r\n#.#....#.#.####\r\n\r\n.########.##.####\r\n..#..#.#..#####..\r\n.#.#..#.#........\r\n#..#..#..##...###\r\n.#......#.#....##\r\n##.#..#.##.##.#..\r\n....##....#.###..\r\n\r\n###.##.#.\r\n##...#...\r\n...##.#..\r\n##...#...\r\n##...#...\r\n...##.#..\r\n##...#...\r\n###.##.#.\r\n###..####\r\n....#...#\r\n#.#..###.\r\n\r\n.######.####.\r\n.#.##.#.#.#..\r\n.........###.\r\n#.####.##.###\r\n#.#..#.#.#..#\r\n#.#..#.#.....\r\n#......#..##.\r\n..####...####\r\n.........#..#\r\n##.##.##.##..\r\n###..##.###.#\r\n########.....\r\n#.#..#.##..#.\r\n#.#..#.##..#.\r\n########.....\r\n\r\n.####.#.##.###.\r\n##..##...#####.\r\n##..##...##.###\r\n####.#.#.##..##\r\n##..##.##...##.\r\n#.##.##..###...\r\n#....##.##.###.\r\n######.###.#.##\r\n##..##..#######\r\n##..##..#######\r\n######.###.#.##\r\n#....##.##.###.\r\n#.##.##..###...\r\n\r\n.##.####.\r\n#...#####\r\n#.######.\r\n###.#...#\r\n###.#...#\r\n#.#####..\r\n#...#####\r\n.##.####.\r\n#.#...#..\r\n...##..##\r\n...##..##\r\n#.#...#..\r\n.##.####.\r\n#...#####\r\n#.#####..\r\n\r\n####...####....\r\n####.....#.#...\r\n.##...##.#.#.##\r\n####.....##..##\r\n#..##..##..####\r\n.##.###..##.###\r\n#..#.#..##...##\r\n#..##...#.#....\r\n.##.##.#.###.##\r\n####...##..#.##\r\n.....####..###.\r\n\r\n...###..##.\r\n.###...#.#.\r\n#..#.######\r\n.#..#.#.#..\r\n#...######.\r\n.##.####.##\r\n.#####.###.\r\n.#####.###.\r\n.##.####.##\r\n#...#.####.\r\n.#..#.#.#..\r\n#..#.######\r\n.###...#.#.\r\n...###..##.\r\n#####..#.##\r\n####....##.\r\n####....##.\r\n\r\n####..#..###.####\r\n.##..####.####..#\r\n.##..###..####..#\r\n####..#..###.####\r\n.##.#..#.####....\r\n####.###.#.#.....\r\n###..###..#......\r\n#...#####.#..#..#\r\n...##..###....##.\r\n\r\n.#....#..#.\r\n..#..#....#\r\n.##..##..##\r\n.#.##.#..#.\r\n.##..##..##\r\n#..##..##..\r\n#.#..#....#\r\n..####....#\r\n##....####.\r\n\r\n#.####.\r\n#.####.\r\n#......\r\n.#.#..#\r\n#####.#\r\n..#...#\r\n.####..\r\n.####..\r\n..#...#\r\n#####.#\r\n.#....#\r\n\r\n##..###...##.\r\n##..#..##.#..\r\n##..#..##.#..\r\n##.####...##.\r\n####...##.##.\r\n...####.#####\r\n..#..####..##\r\n\r\n..#..##.####.##..\r\n####.#.####...##.\r\n##....#.#...#.###\r\n....#.###..###..#\r\n##.#####.##.#..##\r\n..###....####..#.\r\n###.#..####......\r\n.#.#..##.#####.##\r\n....#.....###..#.\r\n..#.#.##...##....\r\n####........##...\r\n##..#.....#.#.###\r\n##.##..#...##.###\r\n..#..##.......##.\r\n..#..##.......##.\r\n##.##..#...##.###\r\n##..#.....#.#.###\r\n\r\n..#....#..#..#.\r\n.####.###..##..\r\n.########.####.\r\n.#......#......\r\n.#.####.#.####.\r\n..######..#..#.\r\n#...##...######\r\n..######.......\r\n..######..#..#.\r\n..######..####.\r\n##..##..##....#\r\n\r\n#.#........\r\n..###.#..#.\r\n...####..##\r\n...####..##\r\n..###.#..#.\r\n#.#........\r\n..#.##.##.#\r\n....##.##.#\r\n.##.##....#\r\n.#...##..##\r\n.##...#..#.\r\n#..#####.##\r\n#..#..#..#.\r\n#.####....#\r\n#.#.###..##\r\n\r\n.##...####.\r\n....#######\r\n.##.#...#..\r\n.##....####\r\n#....##..#.\r\n#....##..#.\r\n.##...#####\r\n.##.#...#..\r\n....#######\r\n.##...####.\r\n...####.##.\r\n..###..#..#\r\n..###..#..#\r\n\r\n##.###.##....##.#\r\n#..#...#.#..#.#..\r\n......###.##.###.\r\n.##.#.##########.\r\n#..#...#.####.#..\r\n.##...#.######.#.\r\n######.#......#.#\r\n\r\n#..#.#..##.##.#\r\n.##...#####..##\r\n.##...#..#....#\r\n#..#######.##.#\r\n#####.###.####.\r\n#..##....#....#\r\n.....##.#.#..#.\r\n....##.##......\r\n##.##.#.##....#\r\n\r\n##...##\r\n...##..\r\n###.#..\r\n.#..###\r\n###.##.\r\n###...#\r\n.....##\r\n...#...\r\n##.##.#\r\n..#.#.#\r\n..#.#.#\r\n##.##.#\r\n...#...\r\n.....##\r\n###...#\r\n\r\n###....#..#..#..#\r\n.#....#..........\r\n.#...######..####\r\n..#.##.##.####.##\r\n..####.#...##...#\r\n#.#...##.######.#\r\n....#####......##\r\n....#####......##\r\n#.#.#.##.######.#\r\n\r\n.#..#..#.##\r\n##..#####..\r\n..##......#\r\n.#..#..####\r\n..##..###..\r\n..##..####.\r\n.#..#..####\r\n\r\n.##...###.###..\r\n#..####..#.#.##\r\n.#.####.#.###..\r\n..##..##.......\r\n.#..##..#..##..\r\n.#.#..#.#....##\r\n..#.##.#..#.#..\r\n..#.##.#..#.#..\r\n#.#....#.######\r\n....##....#..##\r\n#........###...\r\n\r\n##..#..##..##..#.\r\n...#.#.#####.##.#\r\n#.#....######..##\r\n..###.#..###.##.#\r\n.####..####..##..\r\n#.########...##..\r\n####.#......#..#.\r\n#.#......##......\r\n#.#......##......\r\n####.#......#..#.\r\n#.########...##..\r\n\r\n######.#..#......\r\n######.#..#......\r\n#######......##..\r\n#..##.####...####\r\n.#.....#.#.###..#\r\n#.##..#.....#...#\r\n......##.#....#.#\r\n...#.#...#..####.\r\n.###..####...#.##\r\n.###..####...#.##\r\n...#.#...#..####.\r\n......#..#....#.#\r\n#.##..#.....#...#\r\n.#.....#.#.###..#\r\n#..##.####...####\r\n\r\n.#.#...##......\r\n.###..#.###.###\r\n.#..#.#.#....##\r\n............###\r\n#.#.#.######.##\r\n###.#.###.#.###\r\n#.#........##..\r\n..##..#....####\r\n.####...##.##..\r\n#.#.....#.#.###\r\n#.#..###.###.##\r\n#.#..###.######\r\n#.#.....#.#.###\r\n\r\n##.#.#.\r\n#.###.#\r\n.....#.\r\n#.#.###\r\n##..#.#\r\n.#..#.#\r\n#.#.###\r\n.....#.\r\n#.###.#\r\n##.#.#.\r\n#.....#\r\n######.\r\n######.\r\n#.....#\r\n##.#.#.\r\n\r\n..#..#.....\r\n........##.\r\n........#..\r\n..#..#.....\r\n...##....#.\r\n.##..##..#.\r\n........#..\r\n..#..#...##\r\n#.#..#.##.#\r\n\r\n..#..#####.\r\n.###..###.#\r\n.###..##.##\r\n..##.######\r\n.....####.#\r\n.#.##.#.#..\r\n##....#..#.\r\n##....#..#.\r\n.#.##...#..\r\n.....####.#\r\n..##.######\r\n.###..##.##\r\n.###..###.#\r\n..#..#####.\r\n..#..#####.\r\n\r\n.##.#.##.#.#.#..#\r\n.#######..#.###.#\r\n..#..##...#...#.#\r\n..#..##....###.##\r\n..#..##....###.##\r\n..##.##...#...#.#\r\n.#######..#.###.#\r\n.##.#.##.#.#.#..#\r\n#####..##..##...#\r\n.#.#...#####.....\r\n..###.#.#..####..\r\n.##.#...##...#..#\r\n.##.#...##...#..#\r\n\r\n.###.#...#.\r\n#......####\r\n#..##...###\r\n.##.##..###\r\n#.#..##.##.\r\n..###..#.##\r\n..#.##.##..\r\n##.##.###..\r\n..#....###.\r\n.##....###.\r\n##.##.###..\r\n##.##.###..\r\n.##....###.\r\n..#....###.\r\n##.##.###..\r\n\r\n##...##\r\n#####..\r\n..#..#.\r\n...#.##\r\n####..#\r\n..####.\r\n#####..\r\n##...#.\r\n####.#.\r\n###..#.\r\n##...#.\r\n#####..\r\n..####.\r\n####..#\r\n...#.##\r\n\r\n.##.####.\r\n#.#.#..#.\r\n..#####.#\r\n....####.\r\n.########\r\n#####..##\r\n##.######\r\n##.######\r\n.##..##..\r\n###......\r\n###......\r\n.##..##..\r\n##.######\r\n##.######\r\n#####..##\r\n\r\n..#...#.....###..\r\n##.#....#...#....\r\n#..##......#..#..\r\n###..#....#.##.##\r\n#.#..#....#.##.##\r\n#..##......#..#..\r\n##.#....#...#....\r\n..#...#.....###..\r\n#..###..#.#......\r\n.#...###.####.#..\r\n.#........###....\r\n###..#..##.....##\r\n...#.#..##..#....\r\n\r\n#.#..###.\r\n.#.#####.\r\n#......#.\r\n...#.####\r\n.....####\r\n#......#.\r\n.#.#####.\r\n#.#..###.\r\n#.##...#.\r\n..#.#....\r\n..#.#....\r\n\r\n.....#..#\r\n...#..###\r\n#####..##\r\n##..###..\r\n########.\r\n###...#..\r\n##.##.#.#\r\n..##.##.#\r\n##.....#.\r\n...#.####\r\n...#.####\r\n##.#...#.\r\n..##.##.#\r\n\r\n..#.#..#.#...\r\n##.#.##.#.###\r\n.#..####..#..\r\n..#..##..#...\r\n#.##.##.##.##\r\n.....##......\r\n#...#..#...##\r\n##.######.###\r\n...##..##....\r\n#..##..##..##\r\n...#....#....\r\n#.#.#..#.#.##\r\n###..##..#.##\r\n#.##.##.##.##\r\n####....#####\r\n\r\n##.###.##.....#.#\r\n##..##.####.####.\r\n..###.#.###.##.##\r\n........#...##...\r\n.##....##.#..####\r\n##.#.###...###.##\r\n#####.#.##....##.\r\n###..##.#..#...##\r\n...##.#.#..#####.\r\n....#####....##..\r\n...##..#.#.#..##.\r\n..#.###...#..##.#\r\n..#.###...#..##.#\r\n...##..#.#.#..##.\r\n....#####....##..\r\n\r\n...##..##.##.\r\n...##..##.##.\r\n###.##.#.#...\r\n...###.##...#\r\n####.##.###.#\r\n##.#.#..##..#\r\n..#.#####...#\r\n######....#.#\r\n.....###.#.#.\r\n#..#.##..##.#\r\n.....#...#.#.\r\n\r\n.#........#.#\r\n#..#.##.#..##\r\n##.##..##.###\r\n..###..###...\r\n..###..###...\r\n##.##..##.###\r\n#..#.##.#..##\r\n.#........#.#\r\n#####...#####\r\n.###.##.###..\r\n####....####.\r\n\r\n#...#.#..###...\r\n##..#.#..###...\r\n#.#..#.#####.#.\r\n#.#..#.#####.#.\r\n##..#.#..###...\r\n#...#.#..###...\r\n#..#.....#..###\r\n##....##..##.##\r\n..##.##....##.#\r\n\r\n######..#\r\n...#.#..#\r\n.#...####\r\n####.#..#\r\n#.###.##.\r\n..#...##.\r\n.....#..#\r\n...#.....\r\n###.#.##.\r\n.##..#..#\r\n.#.##....\r\n.#.##....\r\n.##.##..#\r\n###.#.##.\r\n...#.....\r\n\r\n..##.##.#....\r\n.##########..\r\n.##########..\r\n..##.##.#.#..\r\n.######..##..\r\n###..#.####..\r\n#...#.#..##..\r\n.#.#...#..###\r\n#.##.#.####..\r\n..#####...###\r\n..#..##....##\r\n.#.####.##...\r\n#.########.##\r\n\r\n...#..#.#..#.###.\r\n...#..#.#..#..##.\r\n..#....#..#.##..#\r\n.#.##.#..##....#.\r\n###....#..#.#..##\r\n##.#.##.#...#...#\r\n##......##...#.##\r\n#.....#..#.....##\r\n..##..#####..###.\r\n##.##.##.#....##.\r\n##.##.##.#....##.\r\n..##..#####..###.\r\n#.....#..#.....##\r\n\r\n##.####\r\n...##.#\r\n#.#.##.\r\n#.#.##.\r\n...##.#\r\n##.####\r\n##.###.\r\n###..##\r\n.##..##\r\n\r\n#..###..##.#.#.\r\n##.##.#####.#..\r\n##.#.#.#....###\r\n##.#.#.#....###\r\n##.##.#####.#..\r\n#..###..##.#.#.\r\n...##.#..#..#..\r\n#..###.#####..#\r\n.##..#..#.##...\r\n.##..#..#.##...\r\n#..###.#####..#\r\n...##.#..#..#..\r\n#..###..#..#.#.\r\n##.##.#####.#..\r\n##.#.#.#....###\r\n\r\n##.##....\r\n..##.##.#\r\n..#.#..##\r\n..#.##...\r\n...##.###\r\n..##...#.\r\n#####.##.\r\n###..###.\r\n###..###.\r\n#####.##.\r\n..##...#.\r\n...##.###\r\n..#.##.#.\r\n..#.#..##\r\n..##.##.#\r\n##.##....\r\n###.#####\r\n\r\n###.##.\r\n###.##.\r\n#####.#\r\n..#.##.\r\n#..#..#\r\n.##....\r\n....##.\r\n\r\n###.#.#.##.##..#.\r\n..#...#..#..##...\r\n..##.#...####...#\r\n..#..####.#..##..\r\n..###.#....##....\r\n#####..#..#..###.\r\n##.#.#....######.\r\n##......#..#..#..\r\n......#.##....#..\r\n###...##...##.#.#\r\n####.#.#.#.##.##.\r\n....#.####....#..\r\n....#.#####...#..\r\n####.#.#.#.##.##.\r\n###...##...##.#.#\r\n\r\n.######.........#\r\n#.#.#..#......#..\r\n#######..####..##\r\n#...#.#........#.\r\n#...##.#.#..#.#.#\r\n...#.##.######.##\r\n...#.##.######.##\r\n#...##.#.#..#.#.#\r\n#...#.#........#.\r\n\r\n...#.##.##...##..\r\n......###..#..###\r\n.##...##..###....\r\n.####..###.#.##..\r\n#..#..##.#.##.#..\r\n#.######.###.##..\r\n##.###...#.###.##\r\n##.###...#.###.##\r\n#.#####..###.##..\r\n\r\n#......#....###.#\r\n#......#....###.#\r\n#.#..#.#..####.##\r\n........#.##...#.\r\n#..##..#.#...#...\r\n###.####......##.\r\n.######...###.#..\r\n\r\n.#.####.#.##.##\r\n#........#.#...\r\n..##..##..##...\r\n..##..##..##...\r\n#........#.#...\r\n##.####.####.##\r\n.#..##..#...#.#\r\n.#.####.#.#....\r\n###.##.####.##.\r\n###....###.#..#\r\n###....###.#.##\r\n\r\n##...####..\r\n#....#..#..\r\n###.##..##.\r\n#.##.#..#.#\r\n....######.\r\n....######.\r\n#.##.#..#.#\r\n###.##..##.\r\n#....#..#..\r\n##...####..\r\n#.##.#..#.#\r\n##.##....#.\r\n.##.#.##.#.\r\n\r\n##.#..#.#\r\n##.#..#.#\r\n.#####.#.\r\n##.#...##\r\n.##...#..\r\n#..######\r\n.##.#..#.\r\n..##.##..\r\n..##.##..\r\n.##.#..#.\r\n#..######\r\n.##...#..\r\n##.#...##\r\n..####.#.\r\n##.#..#.#\r\n\r\n#####.#...###..\r\n.##.......##..#\r\n########.#.##..\r\n....###.#..##..\r\n....#...##.##..\r\n.........##...#\r\n#..##.####.###.\r\n#..##.####.###.\r\n.........##...#\r\n....#...##.##..\r\n....###.#..#...\r\n########.#.##..\r\n.##.......##..#\r\n\r\n##..##..#\r\n##..###.#\r\n...##.#..\r\n#.#.##.##\r\n#.#.##.##\r\n...##.#..\r\n##..###.#\r\n##..##..#\r\n#.##.####\r\n\r\n#..####.##.#.\r\n#..####.##.#.\r\n#..##........\r\n.##...##.#.##\r\n#######..####\r\n.##.#.###.#.#\r\n.##..####...#\r\n###.#......##\r\n....#...#.##.\r\n#..#######.##\r\n.##.##...##.#\r\n.##.##.#...##\r\n#..###...####\r\n.##.##...##..\r\n.##.##.##.#..\r\n....#.##.####\r\n.##.#....##.#\r\n\r\n#####.#.##.\r\n###.#.#....\r\n##.##...##.\r\n##...#..##.\r\n...#..#.##.\r\n#####.#####\r\n...#..##..#\r\n..####.#..#\r\n....#...###\r\n...#..##..#\r\n##.#.#.####\r\n........##.\r\n##.####.##.\r\n\r\n..#.###.#.#....#.\r\n###..##.#...##...\r\n.##..##.#...##...\r\n..#.###.#.#....#.\r\n.##..#.###.#..#.#\r\n###.#.##.#......#\r\n##.#..###.#....#.\r\n\r\n#..##..##....##.#\r\n###..####...###..\r\n#..##..##.###.#.#\r\n#..##..##.###.#.#\r\n###..####...###..\r\n#..##..##....##.#\r\n.#........#.#...#\r\n..#..#.......###.\r\n##########.###..#\r\n.#....#..##.###..\r\n##########..##.#.\r\n\r\n.#..#....#.\r\n.####.##.##\r\n#....#..#..\r\n..##......#\r\n##..######.\r\n.####....##\r\n######..###\r\n####.#..#.#\r\n.#..#....#.\r\n\r\n.#...##.#...#\r\n.....##.#...#\r\n..###.#..####\r\n####.#..####.\r\n....##.#..#..\r\n#.###..#.....\r\n##..##.###.##\r\n.##..#.#.#...\r\n..#...#..#.#.\r\n.......####..\r\n#######...#..\r\n.##.#.####.##\r\n.##.#.####.##\r\n\r\n##.##..##.###\r\n..#......#...\r\n.##..##..##..\r\n..##....##...\r\n...#....#....\r\n.##.#..#.##..\r\n#..........##\r\n###.####.####\r\n...##..##....\r\n...#.##.#....\r\n.###.##.###..\r\n#..........##\r\n.....##....##\r\n\r\n##.#.###..#.#.#\r\n##.###.#...####\r\n####..##..#..##\r\n####.###..#..##\r\n##.###.#...####\r\n##.#.###..#.#.#\r\n....#..#...#.#.\r\n##.#..#.##.#.#.\r\n####..#..###..#\r\n..###.##....##.\r\n###...##.....#.\r\n\r\n#.#.#.##..#\r\n#.#.#.##..#\r\n.#..#..#.##\r\n#..#.#.....\r\n...#..####.\r\n########.##\r\n########.##\r\n...#..####.\r\n#..#.#.....\r\n.#..#..#.##\r\n#.#.####..#\r\n\r\n.#..#.....##.....\r\n#..#...##....##..\r\n..#.##.#.####.#.#\r\n.#.#.#..##..##..#\r\n...#..##..##..##.\r\n....#.###....##..\r\n###..............\r\n###...###.##.###.\r\n.....#....##....#\r\n...#.##.##..##.##\r\n...#.##.##..##.##\r\n\r\n.#....###.#\r\n#.########.\r\n#.########.\r\n.#....###.#\r\n.####.....#\r\n#.#...##.##\r\n##.#.......\r\n##.#.#.#.#.\r\n##.#.#.#.#.\r\n##.#.#.....\r\n#.#...##.##\r\n\r\n...##.....#\r\n..##..#####\r\n##..#..####\r\n##..#..####\r\n..##...####\r\n...##.....#\r\n....###....\r\n.#.....#.#.\r\n##...####.#\r\n##...####.#\r\n.#.....#.#.\r\n....###....\r\n...##.....#\r\n\r\n#.##..#..\r\n......#..\r\n...##..#.\r\n.##.#..#.\r\n..#......\r\n..#......\r\n.##.#..#.\r\n...##..#.\r\n......#..\r\n#.##..#..\r\n#####.#..\r\n..##.##..\r\n....###..\r\n....###..\r\n..##.##..\r\n#####.#..\r\n#.##..#.#\r\n\r\n##.##..##\r\n...######\r\n..#......\r\n###.#..#.\r\n.....##..\r\n.###.##.#\r\n..#..##..\r\n\r\n..##...##...#\r\n##..#..##..#.\r\n#..#.#.##.#.#\r\n#..#.#.##.#.#\r\n##..#..##..#.\r\n..##...##...#\r\n#.###########\r\n#...#......#.\r\n##.#..####..#\r\n##..###...##.\r\n.##..##..##..\r\n\r\n.###..#.#...###\r\n...##..##.#..#.\r\n...#.##.#.##.#.\r\n##.#..#..#..#.#\r\n#..###..##..#.#\r\n#.#.#......##..\r\n....#..#..#.#.#\r\n..#.##.#.####.#\r\n..#.##.#.####.#\r\n....#..#..#.#..\r\n#.#.#......##..\r\n#..###..##..#.#\r\n##.#..#..#..#.#\r\n...#.##.#.##.#.\r\n...##..##.#..#.\r\n.###..#.#...###\r\n.###..#.#...###\r\n\r\n##.#.#.....####..\r\n##.#.#.....####..\r\n.#..###.#..#..#..\r\n#.....##.##.##.##\r\n##..#..#.#......#\r\n#...#.##.###..###\r\n######...#.####..\r\n#.....#..#......#\r\n#.##.#..#.##..##.\r\n#.#..##....#..#..\r\n##.#.#.###.####.#\r\n#.###............\r\n.##.####.###..###\r\n.##.##....######.\r\n##...#####.#..#.#\r\n\r\n.##....#..####..#\r\n.##..###..####..#\r\n.##..#...#....#..\r\n.##..#.##..##..##\r\n.##...#...#..#...\r\n#..##.#..#.##.#..\r\n#..##...##.##.##.\r\n########.##..##.#\r\n.##.#.#.###..###.\r\n#..#.##..##..##..\r\n#..#.##.#..##..#.\r\n#..#.####.#....##\r\n#..#..#.#.#..#.#.\r\n.......##......##\r\n.##.##.#.#.##.#.#";

        private IEnumerable<(int, int, int)> GetMatches(IEnumerable<char> input)
        {
            var line = input.ToArray();
            //var matches = true;
            for (var start = 0; start < line.Length / 2; start++)
            {
                for (var end = line.Length - 1; end > start ; end--)
                {
                    var matches = true;
                    for (var run = 0; run < end - start; run++)
                    {
                        if (line[start + run] != line[end - run])
                        {
                            matches = false;
                            break;
                        }
                    }

                    if (matches)
                    {
                        var diff = end - start + 2;
                        if(diff % 2 == 1) { diff++; }
                        yield return (start, end, diff / 2);
                    }
                }
            }
        }

        private bool TryMatch(IEnumerable<char> input,
            out int? horizontalReflectionPoint,
            out int? horizontalReflectionStartColumn,
            out int? horizontalReflectionEndColumn)
        {
            var line = input.ToArray();
            //var matches = true;
            for (var start = 0; start < line.Length - 2; start++)
            {
                for (var end = line.Length - 1; end > start; end--)
                {
                    var matches = true;
                    for (var run = start; run < end; run++)
                    {
                        if (line[run] != line[end - run])
                        {
                            matches = false;
                            break;
                        }
                    }

                    if (matches)
                    {
                        horizontalReflectionStartColumn = start;
                        horizontalReflectionEndColumn = end;
                        horizontalReflectionPoint = (end - start) / 2;
                        return true;
                    }
                }
            }

            //for (int i = 0; i < line.Length - 2; i++)
            //{
            //    var matched = true;
            //    char c = line[i];
            //    var j = 0;
            //    while (i + j < line.Length - j - 1)
            //    {
            //        if (line[i + j] != line[line.Length - j - 1])
            //        {
            //            matched = false;
            //            break;
            //        }
            //        j++;
            //    }
            //    if (matched)
            //    {
            //        horizontalReflectionPoint = i + (line.Length - i) / 2;
            //        horizontalReflectionStartColumn = i;
            //        horizontalReflectionEndColumn = line.Length - 1;
            //        return true;
            //    }
            //}
            horizontalReflectionPoint = null;
            horizontalReflectionStartColumn = null;
            horizontalReflectionEndColumn = null;

            return false;
        }

        private bool TryGetHorizontalReflection(string[] group, out int? horizontalReflectionPoint)
        {
            //horizontalReflectionPoint = null;
            //int? horizontalReflectionStartColumn = null;
            //int? horizontalReflectionEndColumn = null;

            //if (!TryMatch(group[0], out horizontalReflectionPoint, out horizontalReflectionStartColumn, out horizontalReflectionEndColumn))
            //{
            //    //TryMatch(group[0].Reverse(), out horizontalReflectionPoint, out horizontalReflectionStartColumn, out horizontalReflectionEndColumn);

            //    //// We reversed the string so need to count everything from the end.
            //    //horizontalReflectionEndColumn = group[0].Length - horizontalReflectionStartColumn;
            //    //horizontalReflectionStartColumn = 0;
            //    //horizontalReflectionPoint = group[0].Length - horizontalReflectionPoint;
            //}

            //if (!horizontalReflectionPoint.HasValue)
            //{
            //    return false;
            //}
            foreach (var (start, end, reflectionPoint) in GetMatches(group[0]))
            {
                var matched = true;
                foreach (var line in group)
                {
                    for (var i = 0; i <= reflectionPoint - start; i++)
                    {
                        if (line[i + start] != line[end - i])
                        {
                            horizontalReflectionPoint = null;

                            matched = false;
                            break;
                        }
                    }
                    if (!matched)
                    {
                        break;
                    }
                }

                if (matched)
                {
                    horizontalReflectionPoint = reflectionPoint;

                    return true;
                }
            }

            horizontalReflectionPoint = null;
            return false;

        }

        private bool TryGetVerticalRefletionPoint(string[] group, out int? verticalRefletionPoint)
        {
            var g2 = new string[group[0].Length];

            for (int i = 0; i < group.Length; i++)
            {
                for (int j = 0; j < group[i].Length; j++)
                {
                    char c = group[i][j];
                    g2[j] += c;
                }
            }

            return TryGetHorizontalReflection(
                g2
                    .Select(x => string.Join("", x))
                    .ToArray(),
                out verticalRefletionPoint);
        }

        public void Part1()
        {
            _input = "#.##..##.\r\n..#.##.#.\r\n##......#\r\n##......#\r\n..#.##.#.\r\n..##..##.\r\n#.#.##.#.\r\n\r\n#...##..#\r\n#....#..#\r\n..##..###\r\n#####.##.\r\n#####.##.\r\n..##..###\r\n#....#..#";

            var groups = _input.Split("\r\n\r\n", StringSplitOptions.RemoveEmptyEntries).Select(x => x.Split(new char[] { '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries));
            var summary = 0;
            foreach (var group in groups)
            {
                if (TryGetHorizontalReflection(group, out var reflectionPoint))
                {
                    summary += reflectionPoint.Value;
                }

                else if (TryGetVerticalRefletionPoint(group, out reflectionPoint))
                {
                    reflectionPoint = group.Length - reflectionPoint.Value;
                    summary += reflectionPoint.Value * 100;
                }
            }

            Console.WriteLine(summary);
        }


        public void Part2() { }
    }
}
